{% extends "base.html" %}
{% block title %}Случайный тест{% endblock %}

{% block content %}
<div class="page-container">
    <h1 class="page-title">Случайный тест</h1>
    <p class="text-muted">Выберите категории и класс — мы соберём случайный набор вопросов.</p>

    {% if error %}<div class="alert alert-error">{{ error }}</div>{% endif %}

    <div class="card">
        <form method="post" class="form">
            <div class="field">
                <label class="field-label">Категории (корневые)</label>
                <div class="checkbox-grid">
                    {% if categories %}
                        {% for cat in categories %}
                            <label class="checkbox">
                                <input type="checkbox"
                                       name="category_ids"
                                       value="{{ cat.id }}"
                                       {% if selected_categories and cat.id in selected_categories %}checked{% endif %}>
                                <span>{{ cat.label }}</span>
                            </label>
                        {% endfor %}
                    {% else %}
                        <div class="text-muted">Нет доступных категорий.</div>
                    {% endif %}
                </div>
                <div class="muted">Если ничего не выбрать — возьмём из всех категорий.</div>
            </div>

            <div class="field inline-fields">
                <div>
                    <label class="field-label">Класс</label>
                    <select name="grade" class="field-input">
                        <option value="">Любой</option>
                        {% for g in grade_choices %}
                            <option value="{{ g }}" {% if grade and grade == g %}selected{% endif %}>{{ g }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="field-label">Количество вопросов</label>
                    <input type="number" min="1" max="50" name="count" class="field-input" value="{{ count or 10 }}">
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Собрать тест</button>
        </form>
    </div>
</div>

<style>
    .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 8px; }
    .checkbox { display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 8px; background: rgba(255,255,255,0.03); }
    .inline-fields { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
</style>
{% endblock %}
