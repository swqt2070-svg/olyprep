{% extends "base.html" %}
{% block title %}Импорт задач — OlyPrep{% endblock %}
{% block content %}
<div class="page-header">
    <div>
        <div class="page-title">Импорт задач из Obsidian</div>
        <div class="page-subtitle">
            Закинь ZIP с .md файлами — мы вытащим текст до строки <code>Ответ:</code> как условие задачи,
            а то, что после <code>Ответ:</code>, станет правильным ответом.
        </div>
    </div>
</div>

<section class="card card-narrow">
    {% if error %}
        <div class="alert alert-error">{{ error }}</div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="form">
        <div class="field">
            <label class="field-label">ZIP‑архив с .md файлами <span>*</span></label>
            <input type="file" name="archive" accept=".zip" required>
            <p class="muted" style="margin-top:0.35rem;">
                Например, экспорт папки из Obsidian в ZIP. Внутри должны быть обычные .md файлы с задачами.
            </p>
        </div>

        <button type="submit" class="btn btn-primary">Импортировать</button>
    </form>
</section>

{% if summary %}
<section class="card" style="margin-top:1.5rem;">
    <div class="card-header">
        <h1 class="card-title">Результаты импорта</h1>
    </div>
    <p>Архив: <strong>{{ summary.filename }}</strong></p>
    <p>
        Добавлено задач: <strong>{{ summary.imported_count }}</strong>,
        пропущено файлов: <strong>{{ summary.skipped_count }}</strong>.
    </p>

    {% if summary.created_questions and summary.created_questions|length > 0 %}
        <div class="table-card" style="margin-top:0.75rem;">
            <table>
                <thead>
                    <tr>
                        <th style="width:70px;">ID</th>
                        <th>Текст задачи</th>
                    </tr>
                </thead>
                <tbody>
                    {% for q in summary.created_questions %}
                        <tr>
                            <td>#{{ q.id }}</td>
                            <td>
                                {{ q.text[:160] }}{% if q.text|length > 160 %}…{% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</section>
{% endif %}
{% endblock %}
