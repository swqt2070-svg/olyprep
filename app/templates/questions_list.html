{% extends "base.html" %}
{% block title %}Библиотека задач — OlyPrep{% endblock %}
{% block content %}
<div class="page-header">
    <div>
        <div class="page-title">Библиотека задач</div>
        <div class="page-subtitle">
            Все задачи, доступные для использования в тестах.
        </div>
    </div>
    <div class="page-actions">
        {% if user and user.role in ['admin', 'teacher'] %}
            <a href="/ui/questions/new" class="btn btn-primary">Новая задача</a>
        {% endif %}
    </div>
</div>

<section class="card">
    {% if error %}
        <div class="alert alert-error">{{ error }}</div>
    {% endif %}
    {% if success %}
        <div class="alert alert-success">{{ success }}</div>
    {% endif %}

    {% if not questions or questions|length == 0 %}
        <p class="muted">В библиотеке пока нет задач.</p>
    {% else %}
        <section class="table-card">
            <table>
                <thead>
                    <tr>
                        <th style="width:70px;">ID</th>
                        <th>Текст</th>
                        <th style="width:140px;">Тип</th>
                        {% if user and user.role in ['admin', 'teacher'] %}
                            <th style="width:210px;">Действия</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for q in questions %}
                        <tr>
                            <td>#{{ q.id }}</td>
                            <td>
                                {{ q.text[:140] }}{% if q.text|length > 140 %}…{% endif %}
                            </td>
                            <td>
                                {% if q.answer_type == 'text' %}
                                    Текст
                                {% elif q.answer_type == 'single' %}
                                    Один вариант
                                {% elif q.answer_type == 'multi' %}
                                    Несколько вариантов
                                {% else %}
                                    {{ q.answer_type }}
                                {% endif %}
                            </td>
                            {% if user and user.role in ['admin', 'teacher'] %}
                                <td>
                                    <a href="/ui/questions/{{ q.id }}/edit"
                                       class="btn btn-ghost"
                                       style="padding:0.25rem 0.7rem; font-size:0.78rem;">
                                        Редактировать
                                    </a>
                                    <form method="post"
                                          action="/ui/questions/{{ q.id }}/delete"
                                          style="display:inline;">
                                        <button type="submit"
                                                class="btn btn-ghost"
                                                style="padding:0.25rem 0.7rem; font-size:0.78rem; margin-left:0.25rem;"
                                                onclick="return confirm('Удалить вопрос #{{ q.id }}? Он будет удалён из тестов и ответов.');">
                                            Удалить
                                        </button>
                                    </form>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    {% endif %}
</section>
{% endblock %}
